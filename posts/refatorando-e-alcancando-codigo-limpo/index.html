<!DOCTYPE html><html lang="en" mode="dark" > <!-- The Head v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Refatorando e alcançando um código limpo | murilo.tech</title><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Refatorando e alcançando um código limpo" /><meta name="author" content="Murilo Costa" /><meta property="og:locale" content="en_US" /><meta name="description" content="Acredito que muitos já devem ter observado que eu sou um praticante de código e design de código limpos, que são um conjunto de práticas e padrões para tornar o código mais legível e simples, melhorando seu entendimento e manutenção." /><meta property="og:description" content="Acredito que muitos já devem ter observado que eu sou um praticante de código e design de código limpos, que são um conjunto de práticas e padrões para tornar o código mais legível e simples, melhorando seu entendimento e manutenção." /><link rel="canonical" href="https://murilo.tech/posts/refatorando-e-alcancando-codigo-limpo/" /><meta property="og:url" content="https://murilo.tech/posts/refatorando-e-alcancando-codigo-limpo/" /><meta property="og:site_name" content="murilo.tech" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-12-07T19:20:00-03:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Refatorando e alcançando um código limpo" /><meta name="twitter:site" content="@muriloramosdc" /><meta name="twitter:creator" content="@Murilo Costa" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"Acredito que muitos já devem ter observado que eu sou um praticante de código e design de código limpos, que são um conjunto de práticas e padrões para tornar o código mais legível e simples, melhorando seu entendimento e manutenção.","@type":"BlogPosting","url":"https://murilo.tech/posts/refatorando-e-alcancando-codigo-limpo/","headline":"Refatorando e alcançando um código limpo","datePublished":"2020-12-07T19:20:00-03:00","dateModified":"2020-12-07T19:20:00-03:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://murilo.tech/posts/refatorando-e-alcancando-codigo-limpo/"},"author":{"@type":"Person","name":"Murilo Costa"},"@context":"https://schema.org"}</script> <!-- The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps Generated by: https://www.favicon-generator.org/ v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT license --><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"> <!-- CSS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" async></script> <!-- JS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed --> <script src="/assets/js/post.min.js" async></script> <script src="/app.js" defer></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"> <!-- The Side Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/profile/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">murilo.tech</a></div><div class="site-subtitle font-italic">Posts sobre tecnologia, TI e desenvolvimento de software em geral.</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIAS</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARQUIVO</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>SOBRE</span> </a></li></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <a href="https://github.com/murilo-ramos" target="_blank"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/muriloramosdc" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:window.open('mailto:' + ['murilo','murilo.tech'].join('@'))" > <i class="fas fa-envelope"></i> </a> <a href="https://www.linkedin.com/in/muriloramosduartecosta " target="_blank"> <i class="fab fa-linkedin"></i> </a></div></div><!-- The Top Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Refatorando e alcançando um código limpo</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Buscar..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"> <!-- Refactor the HTML structure. --> <!-- Suroundding the markdown table with '<div class="table-wrapper">. and '</div>' --> <!-- Fixed kramdown code highlight rendering: https://github.com/penibelst/jekyll-compress-html/issues/101 https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901 --><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Refatorando e alcançando um código limpo</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Dec 7, 2020, 7:20 PM -0300" > Dec 7, 2020 <i class="unloaded">2020-12-07T19:20:00-03:00</i> </span> by <span class="author"> Murilo Costa </span></div><div> Updated <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Mon, Jan 18, 2021, 5:27 PM -0300" > Jan 18, 2021 <i class="unloaded">2021-01-18T17:27:09-03:00</i> </span></div></div><div class="post-content"><p style="text-align: justify;">Acredito que muitos já devem ter observado que eu sou um praticante de <a href="https://www.hostgator.com.br/blog/clean-code-o-que-e/" target="_blank">código e design de código limpos</a>, que são um conjunto de práticas e padrões para tornar o código mais legível e simples, melhorando seu entendimento e manutenção.</p><p style="text-align: justify;">Existe bastante debate sobre esse assunto onde muitos se perguntam se realmente essas práticas agregam algum valor ao software desenvolvido, visto que quando seguimos metodologias de desenvolvimento é sempre o cliente/usuário que deve ser priorizado, e para eles o importante é o software estar funcionando.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/posts/refatorando-e-alcancando-codigo-limpo/my-code-runs.png" alt="Meu codigo roda 9gag" /></p><p><em>Imagem disponibilizada gentilmente pelo <a href="https://9gag.com/gag/an9LbjL" target="_blank">9gag</a>.</em></p><p style="text-align: justify;">Porém, baseado em minha experiência e em tudo que já vi por aí preciso dizer que o código simples, bem arquitetado e legível é de extrema importância no desenvolvimento de software, pois existe uma coisa que todos os softwares possuem em comum: <strong>A mudança!</strong></p><p style="text-align: justify;">São extremamente raros os softwares em que se desenvolve apenas uma vez e nunca mais ocorre uma manutenção ou atualização, e aqui fica explícito que em qualquer manutenção ou atualização vai ser necessário que alguém leia e altere o código existente, onde começa o problema pois se o software tiver sido mal escrito será bem difícil realizar a devida mudança nesse código, o que geralmente se traduz em prazos de desenvolvimento muito maiores do que o necessário.</p><p style="text-align: justify;">Por isso resolvi compartilhar umas dicas de refatoração para melhorar a legibilidade e design de códigos ‘não muito bem escritos’ que podem transformá-los em algo que possa ser facilmente entendido por qualquer desenvolvedor.</p><h2 id="o-exemplo"><strong>O Exemplo</strong></h2><p style="text-align: justify;">Vamos usar como projeto de exemplo uma aplicação simples em C# (plataforma .Net Core) que tem o seguinte objetivo:</p><h3 id="1-ler-dados-contendo-informações-de-funcionários-de-uma-empresa-em-formato-texto">1) Ler dados contendo informações de funcionários de uma empresa, em formato texto</h3><p style="text-align: justify;">O arquivo será um csv simples separado por ponto e vírgula, possuindo os campos ID, Nome, Gênero, Telefone e Data de Contratação.</p><p>Exemplo:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>001301;AGENOR DE MIRANDA ARAUJO NETO;NI;2112345678;10/02/2019
001302;PRISCILLA NOVAES LEONE;F;7111223344;22/04/2020
001303;CASSIA REJANE ELLER;F;2111112222;30/07/2019
001304;RENATO MANFREDINI JUNIOR;M;61135724685;13/08/2019
</pre></table></code></div></div><h3 id="2-validar-os-dados-lidos">2) Validar os dados lidos</h3><p style="text-align: justify;">As regras de validação são somente duas: 1) O arquivo precisa ter todos os IDs começando com ‘0013’; 2) A data de contratação não pode ser menor que 01/01/2019.</p><p style="text-align: justify;">Caso algum valor não esteja de acordo com a validação, toda a importação deve ser abortada.</p><h3 id="3-carregar-em-um-banco-de-dados">3) Carregar em um banco de dados</h3><p style="text-align: justify;">A importação dos dados deve ser feita em um banco de dados MySQL chamado <code class="language-plaintext highlighter-rouge">company</code>, na tabela <code class="language-plaintext highlighter-rouge">employees</code>.</p><div class="language-sql highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`employees`</span> <span class="p">(</span>
  <span class="nv">`id`</span>     <span class="nb">varchar</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`name`</span>   <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`gender`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`phone`</span>  <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`hire_date`</span>  <span class="nb">datetime</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`import_date`</span> <span class="nb">datetime</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="nv">`id`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>
</pre></table></code></div></div><p style="text-align: justify;">Coisa simples, não é? Parece ser meio difícil termos um código ruim em uma aplicação simples como essa.</p><p style="text-align: justify;">Então vamos ao código.</p><div class="language-csharp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.IO</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">MySqlConnector</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">FileReader</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">FileReader</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">execute</span><span class="p">(</span><span class="kt">string</span> <span class="n">f</span><span class="p">)</span> <span class="p">{</span>

            <span class="n">MySqlConnectionStringBuilder</span> <span class="n">builder</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MySqlConnectionStringBuilder</span><span class="p">();</span>
            <span class="n">builder</span><span class="p">.</span><span class="n">Server</span> <span class="p">=</span> <span class="s">"localhost"</span><span class="p">;</span>
             <span class="n">builder</span><span class="p">.</span><span class="n">Port</span> <span class="p">=</span> <span class="m">3306</span><span class="p">;</span>
             <span class="n">builder</span><span class="p">.</span><span class="n">Database</span> <span class="p">=</span> <span class="s">"company"</span><span class="p">;</span>
             <span class="n">builder</span><span class="p">.</span><span class="n">UserID</span> <span class="p">=</span> <span class="s">"company"</span><span class="p">;</span>
             <span class="n">builder</span><span class="p">.</span><span class="n">Password</span> <span class="p">=</span> <span class="s">"123456"</span><span class="p">;</span>
            

            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">conn</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MySqlConnection</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">ConnectionString</span><span class="p">))</span> <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Opening connection"</span><span class="p">);</span>
                <span class="n">conn</span><span class="p">.</span><span class="nf">Open</span><span class="p">();</span>

                    <span class="kt">var</span> <span class="n">trans</span> <span class="p">=</span> <span class="n">conn</span><span class="p">.</span><span class="nf">BeginTransaction</span><span class="p">();</span>

                <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">readFile</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StreamReader</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="kt">string</span> <span class="n">line</span><span class="p">;</span>
                      <span class="k">while</span><span class="p">((</span><span class="n">line</span> <span class="p">=</span> <span class="n">readFile</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">())</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>  
                    <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
                          <span class="k">continue</span><span class="p">;</span>
                        

                        <span class="c1">//lendo e validando</span>
                        <span class="kt">string</span><span class="p">[]</span> <span class="n">campos</span> <span class="p">=</span> <span class="n">line</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="s">";"</span><span class="p">);</span>
                        <span class="n">DateTime</span> <span class="n">data</span><span class="p">;</span>
                        <span class="kt">string</span> <span class="n">gender</span><span class="p">;</span>

                        <span class="k">if</span> <span class="p">(!</span><span class="n">campos</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="nf">StartsWith</span><span class="p">(</span><span class="s">"0013"</span><span class="p">))</span> <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="p">(</span><span class="s">"ID não começa com 0013: "</span> <span class="p">+</span> <span class="n">campos</span><span class="p">[</span><span class="m">0</span><span class="p">]);</span>
                        

                        <span class="k">switch</span> <span class="p">(</span><span class="n">campos</span><span class="p">[</span><span class="m">2</span><span class="p">])</span> <span class="p">{</span>
                            <span class="k">case</span> <span class="s">"M"</span><span class="p">:</span>
                            <span class="n">gender</span> <span class="p">=</span> <span class="s">"Masculino"</span><span class="p">;</span>
                            <span class="k">break</span><span class="p">;</span>
                            <span class="k">case</span> <span class="s">"F"</span><span class="p">:</span>
                            <span class="n">gender</span> <span class="p">=</span> <span class="s">"Feminino"</span><span class="p">;</span>
                            <span class="k">break</span><span class="p">;</span>
                            <span class="k">case</span> <span class="s">"NI"</span><span class="p">:</span>
                            <span class="n">gender</span> <span class="p">=</span> <span class="s">"Não Informado"</span><span class="p">;</span>
                            <span class="k">break</span><span class="p">;</span>
                            <span class="k">default</span><span class="p">:</span>
                                <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="p">(</span><span class="s">"Gênero desconhecido: "</span> <span class="p">+</span> <span class="n">campos</span><span class="p">[</span><span class="m">2</span><span class="p">]);</span>
                        <span class="p">}</span>

                        <span class="n">data</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="nf">ParseExact</span><span class="p">(</span><span class="n">campos</span><span class="p">[</span><span class="m">4</span><span class="p">],</span> <span class="s">"dd/MM/yyyy"</span><span class="p">,</span> <span class="n">System</span><span class="p">.</span><span class="n">Globalization</span><span class="p">.</span><span class="n">CultureInfo</span><span class="p">.</span><span class="n">InvariantCulture</span><span class="p">);</span>

                        <span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="p">&lt;</span> <span class="n">DateTime</span><span class="p">.</span><span class="nf">ParseExact</span><span class="p">(</span><span class="s">"01/01/2019"</span><span class="p">,</span> <span class="s">"dd/MM/yyyy"</span><span class="p">,</span> <span class="n">System</span><span class="p">.</span><span class="n">Globalization</span><span class="p">.</span><span class="n">CultureInfo</span><span class="p">.</span><span class="n">InvariantCulture</span><span class="p">))</span>
                        <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="p">(</span><span class="s">"Data de importação não pode ser menor que 01/01/2019: "</span> <span class="p">+</span> <span class="n">campos</span><span class="p">[</span><span class="m">4</span><span class="p">]);</span>


                        <span class="k">using</span> <span class="p">(</span><span class="n">MySqlCommand</span> <span class="n">command</span> <span class="p">=</span> <span class="n">conn</span><span class="p">.</span><span class="nf">CreateCommand</span><span class="p">())</span> <span class="p">{</span>   
                            <span class="n">command</span><span class="p">.</span><span class="n">Transaction</span> <span class="p">=</span> <span class="n">trans</span><span class="p">;</span> 
                            <span class="n">command</span><span class="p">.</span><span class="n">CommandText</span> <span class="p">=</span> <span class="s">@"INSERT INTO employees (id, name, gender, phone, hire_date, import_date) VALUES (@id, @name, @gender, @phone, @hire_date, @import_date)"</span><span class="p">;</span>
                            <span class="n">command</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@id"</span><span class="p">,</span> <span class="n">campos</span><span class="p">[</span><span class="m">0</span><span class="p">]);</span>
                            <span class="n">command</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@name"</span><span class="p">,</span> <span class="n">campos</span><span class="p">[</span><span class="m">1</span><span class="p">]);</span>
                            <span class="n">command</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@gender"</span><span class="p">,</span> <span class="n">gender</span><span class="p">);</span>
                            <span class="n">command</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@phone"</span><span class="p">,</span> <span class="n">campos</span><span class="p">[</span><span class="m">3</span><span class="p">]);</span>
                            <span class="n">command</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@hire_date"</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
                            <span class="n">command</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@import_date"</span><span class="p">,</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">);</span>
                            <span class="n">command</span><span class="p">.</span><span class="nf">ExecuteNonQuery</span><span class="p">();</span>
                        <span class="p">}</span>
                    <span class="p">}</span>  
                <span class="p">}</span>

                <span class="c1">// connection will be closed by the 'using' block</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Closing connection"</span><span class="p">);</span>
                <span class="n">trans</span><span class="p">.</span><span class="nf">Commit</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p style="text-align: justify;">Nunca subestime a chance de um código ser mal escrito rs.</p><h2 id="refatorando"><strong>Refatorando</strong></h2><p style="text-align: justify;">A primeira coisa que podemos fazer nesse código é aplicar pequenas correções no estilo de código, como corrigir a identação (isso é básico, mas infelizmente muitos não ligam rs), deixar o abre/fecha chaves no padrão da linguagem e organizar o código em ‘blocos de contexto’, para facilitar a identificação de onde estão ocorrendo os processos 1,2 e 3 que especificamos no projeto.</p><p style="text-align: justify;">Por enquanto vou colocar comentários no código para facilitar a visualização dos blocos.</p><div class="language-csharp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.IO</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">MySqlConnector</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">FileReader</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">FileReader</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">execute</span><span class="p">(</span><span class="kt">string</span> <span class="n">f</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">MySqlConnectionStringBuilder</span> <span class="n">builder</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MySqlConnectionStringBuilder</span><span class="p">();</span>
            <span class="n">builder</span><span class="p">.</span><span class="n">Server</span> <span class="p">=</span> <span class="s">"localhost"</span><span class="p">;</span>
            <span class="n">builder</span><span class="p">.</span><span class="n">Port</span> <span class="p">=</span> <span class="m">3306</span><span class="p">;</span>
            <span class="n">builder</span><span class="p">.</span><span class="n">Database</span> <span class="p">=</span> <span class="s">"company"</span><span class="p">;</span>
            <span class="n">builder</span><span class="p">.</span><span class="n">UserID</span> <span class="p">=</span> <span class="s">"company"</span><span class="p">;</span>
            <span class="n">builder</span><span class="p">.</span><span class="n">Password</span> <span class="p">=</span> <span class="s">"123456"</span><span class="p">;</span>
            
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">conn</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MySqlConnection</span><span class="p">(</span><span class="n">builder</span><span class="p">.</span><span class="n">ConnectionString</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Opening connection"</span><span class="p">);</span>
                <span class="n">conn</span><span class="p">.</span><span class="nf">Open</span><span class="p">();</span>
                <span class="kt">var</span> <span class="n">trans</span> <span class="p">=</span> <span class="n">conn</span><span class="p">.</span><span class="nf">BeginTransaction</span><span class="p">();</span>

                <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">readFile</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StreamReader</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="kt">string</span> <span class="n">line</span><span class="p">;</span>
                    <span class="k">while</span><span class="p">((</span><span class="n">line</span> <span class="p">=</span> <span class="n">readFile</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">())</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>  
                    <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
                          <span class="k">continue</span><span class="p">;</span>

                        <span class="n">DateTime</span> <span class="n">data</span><span class="p">;</span>
                        <span class="kt">string</span> <span class="n">gender</span><span class="p">;</span>

                        <span class="c1">//1) Lendo dados</span>
                        <span class="kt">string</span><span class="p">[]</span> <span class="n">campos</span> <span class="p">=</span> <span class="n">line</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="s">";"</span><span class="p">);</span>

                        <span class="k">switch</span> <span class="p">(</span><span class="n">campos</span><span class="p">[</span><span class="m">2</span><span class="p">])</span>
                        <span class="p">{</span>
                            <span class="k">case</span> <span class="s">"M"</span><span class="p">:</span>
                                <span class="n">gender</span> <span class="p">=</span> <span class="s">"Masculino"</span><span class="p">;</span>
                                <span class="k">break</span><span class="p">;</span>
                            <span class="k">case</span> <span class="s">"F"</span><span class="p">:</span>
                                <span class="n">gender</span> <span class="p">=</span> <span class="s">"Feminino"</span><span class="p">;</span>
                                <span class="k">break</span><span class="p">;</span>
                            <span class="k">case</span> <span class="s">"NI"</span><span class="p">:</span>
                                <span class="n">gender</span> <span class="p">=</span> <span class="s">"Não Informado"</span><span class="p">;</span>
                                <span class="k">break</span><span class="p">;</span>
                            <span class="k">default</span><span class="p">:</span>
                                <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="p">(</span><span class="s">"Gênero desconhecido: "</span> <span class="p">+</span> <span class="n">campos</span><span class="p">[</span><span class="m">2</span><span class="p">]);</span>
                        <span class="p">}</span>

                        <span class="n">data</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="nf">ParseExact</span><span class="p">(</span><span class="n">campos</span><span class="p">[</span><span class="m">4</span><span class="p">],</span> <span class="s">"dd/MM/yyyy"</span><span class="p">,</span> <span class="n">System</span><span class="p">.</span><span class="n">Globalization</span><span class="p">.</span><span class="n">CultureInfo</span><span class="p">.</span><span class="n">InvariantCulture</span><span class="p">);</span>

                        <span class="c1">//2) Validando dados</span>
                        <span class="k">if</span> <span class="p">(!</span><span class="n">campos</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="nf">StartsWith</span><span class="p">(</span><span class="s">"0013"</span><span class="p">))</span>
                            <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="p">(</span><span class="s">"ID não começa com 0013: "</span> <span class="p">+</span> <span class="n">campos</span><span class="p">[</span><span class="m">0</span><span class="p">]);</span>

                        <span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="p">&lt;</span> <span class="n">DateTime</span><span class="p">.</span><span class="nf">ParseExact</span><span class="p">(</span><span class="s">"01/01/2019"</span><span class="p">,</span> <span class="s">"dd/MM/yyyy"</span><span class="p">,</span> <span class="n">System</span><span class="p">.</span><span class="n">Globalization</span><span class="p">.</span><span class="n">CultureInfo</span><span class="p">.</span><span class="n">InvariantCulture</span><span class="p">))</span>
                            <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="p">(</span><span class="s">"Data de importação não pode ser menor que 01/01/2019: "</span> <span class="p">+</span> <span class="n">campos</span><span class="p">[</span><span class="m">4</span><span class="p">]);</span>

                        
                        <span class="c1">//3) Inserindo dados no banco</span>
                        <span class="k">using</span> <span class="p">(</span><span class="n">MySqlCommand</span> <span class="n">command</span> <span class="p">=</span> <span class="n">conn</span><span class="p">.</span><span class="nf">CreateCommand</span><span class="p">())</span>
                        <span class="p">{</span>   
                            <span class="n">command</span><span class="p">.</span><span class="n">Transaction</span> <span class="p">=</span> <span class="n">trans</span><span class="p">;</span> 
                            <span class="n">command</span><span class="p">.</span><span class="n">CommandText</span> <span class="p">=</span> <span class="s">@"INSERT INTO employees (id, name, gender, phone, hire_date, import_date) VALUES (@id, @name, @gender, @phone, @hire_date, @import_date)"</span><span class="p">;</span>
                            <span class="n">command</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@id"</span><span class="p">,</span> <span class="n">campos</span><span class="p">[</span><span class="m">0</span><span class="p">]);</span>
                            <span class="n">command</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@name"</span><span class="p">,</span> <span class="n">campos</span><span class="p">[</span><span class="m">1</span><span class="p">]);</span>
                            <span class="n">command</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@gender"</span><span class="p">,</span> <span class="n">gender</span><span class="p">);</span>
                            <span class="n">command</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@phone"</span><span class="p">,</span> <span class="n">campos</span><span class="p">[</span><span class="m">3</span><span class="p">]);</span>
                            <span class="n">command</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@hire_date"</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
                            <span class="n">command</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@import_date"</span><span class="p">,</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">);</span>
                            <span class="n">command</span><span class="p">.</span><span class="nf">ExecuteNonQuery</span><span class="p">();</span>
                        <span class="p">}</span>
                    <span class="p">}</span>  
                <span class="p">}</span>

                <span class="c1">// connection will be closed by the 'using' block</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Closing connection"</span><span class="p">);</span>
                <span class="n">trans</span><span class="p">.</span><span class="nf">Commit</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p style="text-align: justify;">Só nessa mudança já podemos perceber que ficou bem mais fácil de entender o código, porém ainda temos muito a fazer.</p><p style="text-align: justify;">Podemos agora melhorar os nomes de variáveis que estávamos usando, pois podemos perceber que o código não está usando nomes muito semânticos, como <code class="language-plaintext highlighter-rouge">f</code> para o arquivo de input e <code class="language-plaintext highlighter-rouge">data</code> para a data de contração de um funcionário, sem contar que temos uma mistura de nomes em inglês e português, o que também fica esquisito sendo o mais correto padronizar em uma língua só: tudo em inglês ou tudo em português.</p><p style="text-align: justify;">Outra melhoria está também no nome do método da classe, que está muito genérico e pode ser melhorado. Aqui podemos também usar recursos da linguagem para simplificar o código, como a construção de objetos usando o padrão de <code class="language-plaintext highlighter-rouge">Properties</code> do C# e também a inferência por tipo usando o <code class="language-plaintext highlighter-rouge">var</code>, que diminui bastante a quantidade de código repetido. E por último vamos adicionar chaves também nos blocos <code class="language-plaintext highlighter-rouge">if</code> que possuem somente uma instrução, pois isso ajuda na legibilidade e facilita a separação de código.</p><div class="language-csharp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.IO</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">MySqlConnector</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">FileReader</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">FileReader</span>
    <span class="p">{</span>
        <span class="k">public</span> <span class="k">void</span> <span class="nf">read</span><span class="p">(</span><span class="kt">string</span> <span class="n">inputFile</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">databaseConnectionBuilder</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MySqlConnectionStringBuilder</span>
            <span class="p">{</span>
                <span class="n">Server</span>   <span class="p">=</span> <span class="s">"localhost"</span><span class="p">,</span>
                <span class="n">Port</span>     <span class="p">=</span> <span class="m">3306</span><span class="p">,</span>
                <span class="n">Database</span> <span class="p">=</span> <span class="s">"company"</span><span class="p">,</span>
                <span class="n">UserID</span>   <span class="p">=</span> <span class="s">"company"</span><span class="p">,</span>
                <span class="n">Password</span> <span class="p">=</span> <span class="s">"123456"</span><span class="p">,</span>
            <span class="p">};</span>
            
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">databaseConnection</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MySqlConnection</span><span class="p">(</span><span class="n">databaseConnectionBuilder</span><span class="p">.</span><span class="n">ConnectionString</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Opening connection"</span><span class="p">);</span>
                <span class="n">databaseConnection</span><span class="p">.</span><span class="nf">Open</span><span class="p">();</span>

                <span class="kt">var</span> <span class="n">connectionTransaction</span> <span class="p">=</span> <span class="n">databaseConnection</span><span class="p">.</span><span class="nf">BeginTransaction</span><span class="p">();</span>

                <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">fileReader</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StreamReader</span><span class="p">(</span><span class="n">inputFile</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="kt">string</span> <span class="n">fileLine</span><span class="p">;</span>
                    <span class="k">while</span><span class="p">((</span><span class="n">fileLine</span> <span class="p">=</span> <span class="n">fileReader</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">())</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>  
                    <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">fileLine</span><span class="p">))</span>
                        <span class="p">{</span>
                          <span class="k">continue</span><span class="p">;</span>
                        <span class="p">}</span>

                        <span class="c1">//1) Lendo dados</span>
                        <span class="kt">var</span> <span class="n">fields</span> <span class="p">=</span> <span class="n">fileLine</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="s">";"</span><span class="p">);</span>

                        <span class="kt">var</span> <span class="n">id</span>       <span class="p">=</span> <span class="n">fields</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
                        <span class="kt">var</span> <span class="n">name</span>     <span class="p">=</span> <span class="n">fields</span><span class="p">[</span><span class="m">1</span><span class="p">];</span>
                        <span class="kt">var</span> <span class="n">gender</span>   <span class="p">=</span> <span class="n">fields</span><span class="p">[</span><span class="m">2</span><span class="p">];</span>
                        <span class="kt">var</span> <span class="n">phone</span>    <span class="p">=</span> <span class="n">fields</span><span class="p">[</span><span class="m">3</span><span class="p">];</span>
                        <span class="kt">var</span> <span class="n">hireDate</span>   <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="nf">ParseExact</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="m">4</span><span class="p">],</span> <span class="s">"dd/MM/yyyy"</span><span class="p">,</span> <span class="n">System</span><span class="p">.</span><span class="n">Globalization</span><span class="p">.</span><span class="n">CultureInfo</span><span class="p">.</span><span class="n">InvariantCulture</span><span class="p">);</span>
                        <span class="kt">var</span> <span class="n">importDate</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">;</span>

                        <span class="k">switch</span> <span class="p">(</span><span class="n">gender</span><span class="p">)</span>
                        <span class="p">{</span>
                            <span class="k">case</span> <span class="s">"M"</span><span class="p">:</span>
                                <span class="n">gender</span> <span class="p">=</span> <span class="s">"Masculino"</span><span class="p">;</span>
                                <span class="k">break</span><span class="p">;</span>
                            <span class="k">case</span> <span class="s">"F"</span><span class="p">:</span>
                                <span class="n">gender</span> <span class="p">=</span> <span class="s">"Feminino"</span><span class="p">;</span>
                                <span class="k">break</span><span class="p">;</span>
                            <span class="k">case</span> <span class="s">"NI"</span><span class="p">:</span>
                                <span class="n">gender</span> <span class="p">=</span> <span class="s">"Não Informado"</span><span class="p">;</span>
                                <span class="k">break</span><span class="p">;</span>
                            <span class="k">default</span><span class="p">:</span>
                                <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="p">(</span><span class="s">"Gênero desconhecido: "</span> <span class="p">+</span> <span class="n">gender</span><span class="p">);</span>
                        <span class="p">}</span>

                        <span class="c1">//2) Validando dados</span>
                        <span class="k">if</span> <span class="p">(!</span><span class="n">id</span><span class="p">.</span><span class="nf">StartsWith</span><span class="p">(</span><span class="s">"0013"</span><span class="p">))</span> 
                        <span class="p">{</span>
                            <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="p">(</span><span class="s">"ID não começa com 0013: "</span> <span class="p">+</span> <span class="n">id</span><span class="p">);</span>
                        <span class="p">}</span>

                        <span class="k">if</span> <span class="p">(</span><span class="n">hireDate</span> <span class="p">&lt;</span> <span class="n">DateTime</span><span class="p">.</span><span class="nf">ParseExact</span><span class="p">(</span><span class="s">"01/01/2019"</span><span class="p">,</span> <span class="s">"dd/MM/yyyy"</span><span class="p">,</span> <span class="n">System</span><span class="p">.</span><span class="n">Globalization</span><span class="p">.</span><span class="n">CultureInfo</span><span class="p">.</span><span class="n">InvariantCulture</span><span class="p">))</span>
                        <span class="p">{</span>
                            <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="p">(</span><span class="s">"Data de importação não pode ser menor que 01/01/2019: "</span> <span class="p">+</span> <span class="n">hireDate</span><span class="p">);</span>
                        <span class="p">}</span>
                        
                        <span class="c1">//3) Inserindo dados no banco</span>
                        <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">databaseCommand</span> <span class="p">=</span> <span class="n">databaseConnection</span><span class="p">.</span><span class="nf">CreateCommand</span><span class="p">())</span>
                        <span class="p">{</span>   
                            <span class="n">databaseCommand</span><span class="p">.</span><span class="n">Transaction</span> <span class="p">=</span> <span class="n">connectionTransaction</span><span class="p">;</span>
                            
                            <span class="n">databaseCommand</span><span class="p">.</span><span class="n">CommandText</span> <span class="p">=</span> <span class="s">@"INSERT INTO employees (id, name, gender, phone, hire_date, import_date) VALUES (@id, @name, @gender, @phone, @hire_date, @import_date)"</span><span class="p">;</span>
                            <span class="n">databaseCommand</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@id"</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
                            <span class="n">databaseCommand</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@name"</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
                            <span class="n">databaseCommand</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@gender"</span><span class="p">,</span> <span class="n">gender</span><span class="p">);</span>
                            <span class="n">databaseCommand</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@phone"</span><span class="p">,</span> <span class="n">phone</span><span class="p">);</span>
                            <span class="n">databaseCommand</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@hire_date"</span><span class="p">,</span> <span class="n">hireDate</span><span class="p">);</span>
                            <span class="n">databaseCommand</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@import_date"</span><span class="p">,</span> <span class="n">importDate</span><span class="p">);</span>

                            <span class="n">databaseCommand</span><span class="p">.</span><span class="nf">ExecuteNonQuery</span><span class="p">();</span>
                        <span class="p">}</span>
                    <span class="p">}</span>  
                <span class="p">}</span>

                <span class="c1">// connection will be closed by the 'using' block</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Closing connection"</span><span class="p">);</span>
                <span class="n">connectionTransaction</span><span class="p">.</span><span class="nf">Commit</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p style="text-align: justify;">Muito melhor, não é mesmo? Podemos observar que agora o código está muito mais legível com blocos organizados, cada variável com um nome que permite entender seu propósito e existe uma lógica na sequência de comandos que está de acordo com os processos que definimos anteriormente.</p><p style="text-align: justify;">Mas ainda temos um problema nesse código: <strong>Ele está muito grande!</strong></p><p style="text-align: justify;">Temos um método de 85 linhas nesse código, e se olharmos os padrões do código limpo vamos ver que isso não é nada legal. Geralmente códigos com muitas linhas acabam fazendo muita coisa em um lugar só, e isso atrapalha muito em sua leitura pois não queremos ver o que um determinado código faz <em>linha-a-linha</em>, e sim queremos entender o <code class="language-plaintext highlighter-rouge">macro</code>, que no nosso caso é ‘ler os dados’, ‘validar os dados’ e ‘inserir os dados’, e somente se necessário olhamos mais a fundo.</p><p style="text-align: justify;">E para alcançar esse resultado podemos usar aqui a famosa tática de ‘dividir para conquistar’, onde vamos separar esse nosso método em métodos menores.</p><p style="text-align: justify;">Vamos então quebrá-lo em três métodos privados que serão chamados no principal. Repare que teremos que criar atributos a nível de classe para serem compartilhados.</p><div class="language-csharp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.IO</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">MySqlConnector</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Dynamic</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">FileReader</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">FileReader</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">dynamic</span><span class="p">&gt;</span> <span class="n">employees</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">dynamic</span><span class="p">&gt;();</span>
        <span class="k">private</span> <span class="kt">string</span> <span class="n">inputFile</span><span class="p">;</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">read</span><span class="p">(</span><span class="kt">string</span> <span class="n">inputFile</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="n">inputFile</span> <span class="p">=</span> <span class="n">inputFile</span><span class="p">;</span>

            <span class="nf">readInputFile</span><span class="p">();</span>
            <span class="nf">validateData</span><span class="p">();</span>
            <span class="nf">importToDatabase</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">readInputFile</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">fileReader</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StreamReader</span><span class="p">(</span><span class="n">inputFile</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="kt">string</span> <span class="n">fileLine</span><span class="p">;</span>
                <span class="k">while</span><span class="p">((</span><span class="n">fileLine</span> <span class="p">=</span> <span class="n">fileReader</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">())</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>  
                <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">fileLine</span><span class="p">))</span>
                    <span class="p">{</span>
                        <span class="k">continue</span><span class="p">;</span>
                    <span class="p">}</span>
                    
                    <span class="kt">var</span> <span class="n">fields</span> <span class="p">=</span> <span class="n">fileLine</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="s">";"</span><span class="p">);</span>

                    <span class="kt">dynamic</span> <span class="n">employee</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ExpandoObject</span><span class="p">();</span>
                    <span class="n">employee</span><span class="p">.</span><span class="n">Id</span>     <span class="p">=</span> <span class="n">fields</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
                    <span class="n">employee</span><span class="p">.</span><span class="n">Name</span>   <span class="p">=</span> <span class="n">fields</span><span class="p">[</span><span class="m">1</span><span class="p">];</span>
                    <span class="n">employee</span><span class="p">.</span><span class="n">Gender</span> <span class="p">=</span> <span class="n">fields</span><span class="p">[</span><span class="m">2</span><span class="p">];</span>
                    <span class="n">employee</span><span class="p">.</span><span class="n">Phone</span>  <span class="p">=</span> <span class="n">fields</span><span class="p">[</span><span class="m">3</span><span class="p">];</span>
                    <span class="n">employee</span><span class="p">.</span><span class="n">HireDate</span>   <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="nf">ParseExact</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="m">4</span><span class="p">],</span> <span class="s">"dd/MM/yyyy"</span><span class="p">,</span> <span class="n">System</span><span class="p">.</span><span class="n">Globalization</span><span class="p">.</span><span class="n">CultureInfo</span><span class="p">.</span><span class="n">InvariantCulture</span><span class="p">);</span>
                    <span class="n">employee</span><span class="p">.</span><span class="n">ImportDate</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">;</span>

                    <span class="k">switch</span> <span class="p">(</span><span class="n">employee</span><span class="p">.</span><span class="n">Gender</span><span class="p">)</span>
                    <span class="p">{</span>
                        <span class="k">case</span> <span class="s">"M"</span><span class="p">:</span>
                            <span class="n">employee</span><span class="p">.</span><span class="n">Gender</span> <span class="p">=</span> <span class="s">"Masculino"</span><span class="p">;</span>
                            <span class="k">break</span><span class="p">;</span>
                        <span class="k">case</span> <span class="s">"F"</span><span class="p">:</span>
                            <span class="n">employee</span><span class="p">.</span><span class="n">Gender</span> <span class="p">=</span> <span class="s">"Feminino"</span><span class="p">;</span>
                            <span class="k">break</span><span class="p">;</span>
                        <span class="k">case</span> <span class="s">"NI"</span><span class="p">:</span>
                            <span class="n">employee</span><span class="p">.</span><span class="n">Gender</span> <span class="p">=</span> <span class="s">"Não Informado"</span><span class="p">;</span>
                            <span class="k">break</span><span class="p">;</span>
                        <span class="k">default</span><span class="p">:</span>
                            <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="p">(</span><span class="s">"Gênero desconhecido: "</span> <span class="p">+</span> <span class="n">employee</span><span class="p">.</span><span class="n">Gender</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="n">employees</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">employee</span><span class="p">);</span>
                <span class="p">}</span>  
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">validateData</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">employee</span> <span class="k">in</span> <span class="n">employees</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">//Funcionarios que nao tem seu Id comecando com 0013 pertencem a empresas terceirizadas</span>
                <span class="k">if</span> <span class="p">(!</span><span class="n">employee</span><span class="p">.</span><span class="n">Id</span><span class="p">.</span><span class="nf">StartsWith</span><span class="p">(</span><span class="s">"0013"</span><span class="p">))</span> 
                <span class="p">{</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="p">(</span><span class="s">"ID não começa com 0013: "</span> <span class="p">+</span> <span class="n">employee</span><span class="p">.</span><span class="n">Id</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="c1">//Funcionarios que foram contratados antes de 01/01/2019 nao devem ser importados a mando do RH</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">employee</span><span class="p">.</span><span class="n">HireDate</span> <span class="p">&lt;</span> <span class="n">DateTime</span><span class="p">.</span><span class="nf">ParseExact</span><span class="p">(</span><span class="s">"01/01/2019"</span><span class="p">,</span> <span class="s">"dd/MM/yyyy"</span><span class="p">,</span> <span class="n">System</span><span class="p">.</span><span class="n">Globalization</span><span class="p">.</span><span class="n">CultureInfo</span><span class="p">.</span><span class="n">InvariantCulture</span><span class="p">))</span>
                <span class="p">{</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="p">(</span><span class="s">"Data de importação não pode ser menor que 01/01/2019: "</span> <span class="p">+</span> <span class="n">employee</span><span class="p">.</span><span class="n">HireDate</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">importToDatabase</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">databaseConnectionBuilder</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MySqlConnectionStringBuilder</span>
            <span class="p">{</span>
                <span class="n">Server</span>   <span class="p">=</span> <span class="s">"localhost"</span><span class="p">,</span>
                <span class="n">Port</span>     <span class="p">=</span> <span class="m">3306</span><span class="p">,</span>
                <span class="n">Database</span> <span class="p">=</span> <span class="s">"company"</span><span class="p">,</span>
                <span class="n">UserID</span>   <span class="p">=</span> <span class="s">"company"</span><span class="p">,</span>
                <span class="n">Password</span> <span class="p">=</span> <span class="s">"123456"</span><span class="p">,</span>
            <span class="p">};</span>
            
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">databaseConnection</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MySqlConnection</span><span class="p">(</span><span class="n">databaseConnectionBuilder</span><span class="p">.</span><span class="n">ConnectionString</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Opening connection"</span><span class="p">);</span>
                <span class="n">databaseConnection</span><span class="p">.</span><span class="nf">Open</span><span class="p">();</span>

                <span class="kt">var</span> <span class="n">connectionTransaction</span> <span class="p">=</span> <span class="n">databaseConnection</span><span class="p">.</span><span class="nf">BeginTransaction</span><span class="p">();</span>

                <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">employee</span> <span class="k">in</span> <span class="n">employees</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">databaseCommand</span> <span class="p">=</span> <span class="n">databaseConnection</span><span class="p">.</span><span class="nf">CreateCommand</span><span class="p">())</span>
                    <span class="p">{</span>   
                        <span class="n">databaseCommand</span><span class="p">.</span><span class="n">Transaction</span> <span class="p">=</span> <span class="n">connectionTransaction</span><span class="p">;</span>
                        
                        <span class="n">databaseCommand</span><span class="p">.</span><span class="n">CommandText</span> <span class="p">=</span> <span class="s">@"INSERT INTO employees (id, name, gender, phone, hire_date, import_date) VALUES (@id, @name, @gender, @phone, @hire_date, @import_date)"</span><span class="p">;</span>
                        <span class="n">databaseCommand</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@id"</span><span class="p">,</span> <span class="n">employee</span><span class="p">.</span><span class="n">Id</span><span class="p">);</span>
                        <span class="n">databaseCommand</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@name"</span><span class="p">,</span> <span class="n">employee</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
                        <span class="n">databaseCommand</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@gender"</span><span class="p">,</span> <span class="n">employee</span><span class="p">.</span><span class="n">Gender</span><span class="p">);</span>
                        <span class="n">databaseCommand</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@phone"</span><span class="p">,</span> <span class="n">employee</span><span class="p">.</span><span class="n">Phone</span><span class="p">);</span>
                        <span class="n">databaseCommand</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@hire_date"</span><span class="p">,</span> <span class="n">employee</span><span class="p">.</span><span class="n">HireDate</span><span class="p">);</span>
                        <span class="n">databaseCommand</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@import_date"</span><span class="p">,</span> <span class="n">employee</span><span class="p">.</span><span class="n">ImportDate</span><span class="p">);</span>

                        <span class="n">databaseCommand</span><span class="p">.</span><span class="nf">ExecuteNonQuery</span><span class="p">();</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Closing connection"</span><span class="p">);</span>
                <span class="n">connectionTransaction</span><span class="p">.</span><span class="nf">Commit</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p style="text-align: justify;">Agora sim! Com esta técnica minimizamos em muito o trabalho de quem está lendo e tentando entender nosso código, pois ao abrir a classe já é possível entender o que está acontecendo no método principal, que é a leitura de dados (<code class="language-plaintext highlighter-rouge">readInputFile()</code>), validação de dados (<code class="language-plaintext highlighter-rouge">validateData()</code>) e importação de dados no banco (<code class="language-plaintext highlighter-rouge">importToDatabase()</code>).</p><p style="text-align: justify;">Repare também que que criei uma estrutura de dados do tipo <code class="language-plaintext highlighter-rouge">List</code> para guardar os valores lidos, que armazena valor do tipo <code class="language-plaintext highlighter-rouge">dynamic</code> do C#. Eu usei esse tipo aqui somente para simplificar o código, caso contrário teria que criar uma outra classe para representar o funcionário, porém em projetos reais eu aconselho fortemente que esse tipo de classe seja criada.</p><p style="text-align: justify;">Uma coisa legal de se reparar também nesse código é na sequência de declaração dos métodos, que segue exatamente a sequência em que são chamados: primeiro <code class="language-plaintext highlighter-rouge">readInputFile</code>, segundo <code class="language-plaintext highlighter-rouge">validateData</code> e por último <code class="language-plaintext highlighter-rouge">importToDatabase</code>. Essa é uma boa prática do código limpo que diz que um código deve ser escrito como um livro, onde as páginas correntes tem sua sequência nas páginas posteriores, assim como os códigos correntes devem vir antes dos códigos que são invocados. Além disso, o código limpo também diz que a sequência dos métodos e atributos deve sempre ser ‘públicos’ primeiro e depois ‘privados’, pois alguém que está lendo o código sempre terá conhecimento primeiro da parte pública pois é ela quem é acessada por outros códigos, e por isso deve sempre estar no topo.</p><p style="text-align: justify;">E por último podemos ver também que quando o código é bem estruturado torna-se praticamente nula a necessidade de comentários no código, onde eles devem ser usados somente para explicações de regras de negócio, como acontece em nossa validação.</p><p style="text-align: justify;">E para finalizar podemos fazer mais alguns ajustes para reaproveitar melhor o código, como no caso do parseamento de datas, e também melhorar os logs, que são informações essenciais para se entender problemas que ocorrem quando o software já está em produção.</p><div class="language-csharp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.IO</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">MySqlConnector</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Dynamic</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">FileReader</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">class</span> <span class="nc">FileReader</span>
    <span class="p">{</span>
        <span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="kt">string</span> <span class="n">DateFormat</span> <span class="p">=</span> <span class="s">"dd/MM/yyyy"</span><span class="p">;</span>
        <span class="k">private</span> <span class="k">readonly</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">dynamic</span><span class="p">&gt;</span> <span class="n">employees</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">dynamic</span><span class="p">&gt;();</span>
        <span class="k">private</span> <span class="kt">string</span> <span class="n">inputFile</span><span class="p">;</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">read</span><span class="p">(</span><span class="kt">string</span> <span class="n">inputFile</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="n">inputFile</span> <span class="p">=</span> <span class="n">inputFile</span><span class="p">;</span>

            <span class="nf">readInputFile</span><span class="p">();</span>
            <span class="nf">validateData</span><span class="p">();</span>
            <span class="nf">importToDatabase</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">readInputFile</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Reading input file"</span><span class="p">);</span>
            
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">fileReader</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StreamReader</span><span class="p">(</span><span class="n">inputFile</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="kt">string</span> <span class="n">fileLine</span><span class="p">;</span>
                <span class="k">while</span><span class="p">((</span><span class="n">fileLine</span> <span class="p">=</span> <span class="n">fileReader</span><span class="p">.</span><span class="nf">ReadLine</span><span class="p">())</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>  
                <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">fileLine</span><span class="p">))</span>
                    <span class="p">{</span>
                        <span class="k">continue</span><span class="p">;</span>
                    <span class="p">}</span>
                    
                    <span class="kt">var</span> <span class="n">fields</span> <span class="p">=</span> <span class="n">fileLine</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="s">";"</span><span class="p">);</span>

                    <span class="kt">dynamic</span> <span class="n">employee</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ExpandoObject</span><span class="p">();</span>
                    <span class="n">employee</span><span class="p">.</span><span class="n">Id</span>     <span class="p">=</span> <span class="n">fields</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
                    <span class="n">employee</span><span class="p">.</span><span class="n">Name</span>   <span class="p">=</span> <span class="n">fields</span><span class="p">[</span><span class="m">1</span><span class="p">];</span>
                    <span class="n">employee</span><span class="p">.</span><span class="n">Gender</span> <span class="p">=</span> <span class="nf">getGender</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="m">2</span><span class="p">]);</span>
                    <span class="n">employee</span><span class="p">.</span><span class="n">Phone</span>  <span class="p">=</span> <span class="n">fields</span><span class="p">[</span><span class="m">3</span><span class="p">];</span>
                    <span class="n">employee</span><span class="p">.</span><span class="n">HireDate</span>   <span class="p">=</span> <span class="nf">parseDate</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="m">4</span><span class="p">]);</span>
                    <span class="n">employee</span><span class="p">.</span><span class="n">ImportDate</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">;</span>

                    <span class="n">employees</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">employee</span><span class="p">);</span>
                <span class="p">}</span>  
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">validateData</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Validating data"</span><span class="p">);</span>

            <span class="kt">var</span> <span class="n">matchId</span> <span class="p">=</span> <span class="s">"0013"</span><span class="p">;</span>
            <span class="kt">var</span> <span class="n">minimumHireDate</span> <span class="p">=</span> <span class="nf">parseDate</span><span class="p">(</span><span class="s">"01/01/2019"</span><span class="p">);</span>

            <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">employee</span> <span class="k">in</span> <span class="n">employees</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="c1">//Funcionarios que nao tem seu Id comecando com 0013 pertencem a empresas terceirizadas</span>
                <span class="k">if</span> <span class="p">(!</span><span class="n">employee</span><span class="p">.</span><span class="n">Id</span><span class="p">.</span><span class="nf">StartsWith</span><span class="p">(</span><span class="n">matchId</span><span class="p">))</span> 
                <span class="p">{</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="p">(</span><span class="s">"ID não começa com 0013: "</span> <span class="p">+</span> <span class="n">employee</span><span class="p">.</span><span class="n">Id</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="c1">//Funcionarios que foram contratados antes de 01/01/2019 nao devem ser importados a mando do RH</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">employee</span><span class="p">.</span><span class="n">HireDate</span> <span class="p">&lt;</span> <span class="n">minimumHireDate</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="p">(</span><span class="s">"Data de importação não pode ser menor que 01/01/2019: "</span> <span class="p">+</span> <span class="n">employee</span><span class="p">.</span><span class="n">HireDate</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="k">void</span> <span class="nf">importToDatabase</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Importing to database"</span><span class="p">);</span>

            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">databaseConnection</span> <span class="p">=</span> <span class="nf">createDatabaseConnection</span><span class="p">())</span>
            <span class="p">{</span>
                <span class="n">databaseConnection</span><span class="p">.</span><span class="nf">Open</span><span class="p">();</span>

                <span class="kt">var</span> <span class="n">connectionTransaction</span> <span class="p">=</span> <span class="n">databaseConnection</span><span class="p">.</span><span class="nf">BeginTransaction</span><span class="p">();</span>

                <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">employee</span> <span class="k">in</span> <span class="n">employees</span><span class="p">)</span>
                <span class="p">{</span>
                    <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">databaseCommand</span> <span class="p">=</span> <span class="n">databaseConnection</span><span class="p">.</span><span class="nf">CreateCommand</span><span class="p">())</span>
                    <span class="p">{</span>   
                        <span class="n">databaseCommand</span><span class="p">.</span><span class="n">Transaction</span> <span class="p">=</span> <span class="n">connectionTransaction</span><span class="p">;</span>
                        
                        <span class="n">databaseCommand</span><span class="p">.</span><span class="n">CommandText</span> <span class="p">=</span> <span class="s">@"INSERT INTO employees (id, name, gender, phone, hire_date, import_date) VALUES (@id, @name, @gender, @phone, @hire_date, @import_date)"</span><span class="p">;</span>
                        <span class="n">databaseCommand</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@id"</span><span class="p">,</span> <span class="n">employee</span><span class="p">.</span><span class="n">Id</span><span class="p">);</span>
                        <span class="n">databaseCommand</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@name"</span><span class="p">,</span> <span class="n">employee</span><span class="p">.</span><span class="n">Name</span><span class="p">);</span>
                        <span class="n">databaseCommand</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@gender"</span><span class="p">,</span> <span class="n">employee</span><span class="p">.</span><span class="n">Gender</span><span class="p">);</span>
                        <span class="n">databaseCommand</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@phone"</span><span class="p">,</span> <span class="n">employee</span><span class="p">.</span><span class="n">Phone</span><span class="p">);</span>
                        <span class="n">databaseCommand</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@hire_date"</span><span class="p">,</span> <span class="n">employee</span><span class="p">.</span><span class="n">HireDate</span><span class="p">);</span>
                        <span class="n">databaseCommand</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"@import_date"</span><span class="p">,</span> <span class="n">employee</span><span class="p">.</span><span class="n">ImportDate</span><span class="p">);</span>

                        <span class="n">databaseCommand</span><span class="p">.</span><span class="nf">ExecuteNonQuery</span><span class="p">();</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                
                <span class="n">connectionTransaction</span><span class="p">.</span><span class="nf">Commit</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="kt">string</span> <span class="nf">getGender</span><span class="p">(</span><span class="kt">string</span> <span class="n">gender</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">switch</span> <span class="p">(</span><span class="n">gender</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">case</span> <span class="s">"M"</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s">"Masculino"</span><span class="p">;</span>
                <span class="k">case</span> <span class="s">"F"</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s">"Feminino"</span><span class="p">;</span>
                <span class="k">case</span> <span class="s">"NI"</span><span class="p">:</span>
                    <span class="k">return</span> <span class="s">"Não Informado"</span><span class="p">;</span>
                <span class="k">default</span><span class="p">:</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="p">(</span><span class="s">"Gênero desconhecido: "</span> <span class="p">+</span> <span class="n">gender</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="n">MySqlConnection</span> <span class="nf">createDatabaseConnection</span><span class="p">()</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">databaseConnectionBuilder</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MySqlConnectionStringBuilder</span>
            <span class="p">{</span>
                <span class="n">Server</span>   <span class="p">=</span> <span class="s">"localhost"</span><span class="p">,</span>
                <span class="n">Port</span>     <span class="p">=</span> <span class="m">3306</span><span class="p">,</span>
                <span class="n">Database</span> <span class="p">=</span> <span class="s">"company"</span><span class="p">,</span>
                <span class="n">UserID</span>   <span class="p">=</span> <span class="s">"company"</span><span class="p">,</span>
                <span class="n">Password</span> <span class="p">=</span> <span class="s">"123456"</span><span class="p">,</span>
            <span class="p">};</span>

            <span class="k">return</span> <span class="k">new</span> <span class="nf">MySqlConnection</span><span class="p">(</span><span class="n">databaseConnectionBuilder</span><span class="p">.</span><span class="n">ConnectionString</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="n">DateTime</span> <span class="nf">parseDate</span><span class="p">(</span><span class="kt">string</span> <span class="n">date</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">return</span> <span class="n">DateTime</span><span class="p">.</span><span class="nf">ParseExact</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">DateFormat</span><span class="p">,</span> <span class="n">System</span><span class="p">.</span><span class="n">Globalization</span><span class="p">.</span><span class="n">CultureInfo</span><span class="p">.</span><span class="n">InvariantCulture</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>E terminamos :)</p><h2 id="ponto-negativo"><strong>Ponto negativo</strong></h2><p style="text-align: justify;">O único ponto negativo dessa refatoração seria o fato de que agora ao invés de uma iteração sobre os dados passamos a ter três, pois temos a primeira que lê os dados, a segunda que valida e a terceira que importa pro banco, sendo que no código inicial tudo era feito só em uma iteração. Porém se formos observar mais de perto e levar o famoso <a href="https://pt.khanacademy.org/computing/computer-science/algorithms/asymptotic-notation/a/big-o-notation" target="_blank">Big O</a> na prática, vamos ver que a complexidade desse código é O(3n) (três iterações), que de acordo com as <a href="https://medium.com/@estevestoni/iniciando-com-a-nota%C3%A7%C3%A3o-big-o-be996fa3b47b" target="_blank">regras práticas da complexidade de algoritmos</a> ainda é O(n) (uma iteração), sendo igual ao algoritmo inicial. E para aqueles que devem estar pensando em uma possível otimização eu já adianto: <a href="http://www.vidageek.net/performance-java/otimizacao-prematura/" target="_blank">Otimização prematura é a raiz de todo mal</a>.</p><p style="text-align: justify;">Os códigos desse projeto, tanto o original como o refatorado (incluindo o uso de classe externa) podem ser encontrados <a href="https://github.com/murilo-ramos/murilo-tech/tree/master/FileReader" target="_blank">aqui</a>.</p><p>Até a próxima.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/blogging/'>Blogging</a>, <a href='/categories/c%23/'>C#</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/refatorando/" class="post-tag no-text-decoration" >refatorando</a> <a href="/tags/refatoracao/" class="post-tag no-text-decoration" >refatoracao</a> <a href="/tags/clean-code/" class="post-tag no-text-decoration" >clean-code</a> <a href="/tags/codigo-limpo/" class="post-tag no-text-decoration" >codigo-limpo</a> <a href="/tags/c%23/" class="post-tag no-text-decoration" >c#</a> <a href="/tags/dotnet/" class="post-tag no-text-decoration" >dotnet</a> <a href="/tags/mysql/" class="post-tag no-text-decoration" >mysql</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> Este post está licenciado sob a <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> pelo autor.</div><!-- Post sharing snippet v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div class="share-wrapper"> <span class="share-label text-muted mr-1">Compartilhar</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Refatorando e alcançando um código limpo - murilo.tech&url=https://murilo.tech/posts/refatorando-e-alcancando-codigo-limpo/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Refatorando e alcançando um código limpo - murilo.tech&u=https://murilo.tech/posts/refatorando-e-alcancando-codigo-limpo/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Refatorando e alcançando um código limpo - murilo.tech&url=https://murilo.tech/posts/refatorando-e-alcancando-codigo-limpo/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://murilo.tech/posts/refatorando-e-alcancando-codigo-limpo/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank"> <i class="fa-fw fab fa-linkedin"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><!-- The Pannel on right side (Desktop views) v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><h3 data-toc-skip>Atualizações Recentes</h3><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/criptografia/">Criptografia</a></li><li><a href="/posts/testes-unitarios-com-spring-usando-mock/">Testes unitários com Spring Framework usando mock</a></li><li><a href="/posts/estrategias-para-testes-unitarios/">Estratégias para testes unitários</a></li><li><a href="/posts/refatorando-e-alcancando-codigo-limpo/">Refatorando e alcançando um código limpo</a></li><li><a href="/posts/ferramentas-para-o-ambiente-de-desenvolvimento/">Ferramentas para o ambiente de desenvolvimento</a></li></ul></div><div id="access-tags"><h3 data-toc-skip>Tags Populares</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/programacao/">programacao</a> <a class="post-tag" href="/tags/murilo-tech/">murilo tech</a> <a class="post-tag" href="/tags/murilo/">murilo</a> <a class="post-tag" href="/tags/historia/">historia</a> <a class="post-tag" href="/tags/github/">github</a> <a class="post-tag" href="/tags/software/">software</a> <a class="post-tag" href="/tags/relato/">relato</a> <a class="post-tag" href="/tags/mysql/">mysql</a> <a class="post-tag" href="/tags/maven/">maven</a> <a class="post-tag" href="/tags/jekyll/">jekyll</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2 mb-2">Conteúdo</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <!-- Recommend the other 3 posts according to the tags and categories of the current post, if the number is not enough, use the other latest posts to supplement. v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Para Ler Depois</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/estrategias-para-testes-unitarios/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Jan 18, 2021 <i class="unloaded">2021-01-18T07:30:00-03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Estratégias para testes unitários</h3><div class="text-muted small"><p> Nos dias atuais eu nem preciso explicar aqui a importância da escrita de testes automatizados pois a maioria dos desenvolvedores já entende que ter esses testes em seu software significa qualidade ...</p></div></div></a></div><div class="card"> <a href="/posts/causo-minha-primeira-parada-em-producao/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > Oct 25, 2021 <i class="unloaded">2021-10-25T08:00:00-03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Causo - A minha primeira parada em produção</h3><div class="text-muted small"><p> Hoje estou inaugurando uma seção nesse blog para contar e relatar histórias que vivi atuando como um profissional na área de desenvolvimento de software, ou como gosto de chamar: Os famosos causos!...</p></div></div></a></div><div class="card"> <a href="/posts/coisas-que-aprendi-estudando-certificacao-java/"><div class="card-body"> <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <span class="timeago small" > May 4, 2021 <i class="unloaded">2021-05-04T17:30:00-03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Coisas que aprendi estudando para a certificação Java</h3><div class="text-muted small"><p> Como alguns viram, no último mês de abril foi aniversário da linguagem de programação Java, a linguagem que mais venho utilizando desde meu início de carreira, que está completando 25 anos de idade...</p></div></div></a></div></div></div><!-- Navigation buttons at the bottom of the post. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --><div class="post-navigation d-flex justify-content-between"> <a href="/posts/ferramentas-para-o-ambiente-de-desenvolvimento/" class="btn btn-outline-primary"><p>Ferramentas para o ambiente de desenvolvimento</p></a> <a href="/posts/estrategias-para-testes-unitarios/" class="btn btn-outline-primary"><p>Estratégias para testes unitários</p></a></div><!-- The Disqus lazy loading. Powered by: https://osvaldas.info/lazy-loading-disqus-comments v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung MIT License --><div id="disqus" class="pt-2 pb-2"><p class="font-italic text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> var options = { scriptUrl: '//murilo-tech.disqus.com/embed.js', disqusConfig: function() { this.page.url = 'https://murilo.tech/posts/refatorando-e-alcancando-codigo-limpo/'; this.page.identifier = '/posts/refatorando-e-alcancando-codigo-limpo/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script> <!-- The Footer v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/muriloramosdc">Murilo Costa</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Alguns direitos reservados.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/">Chirpy</a> theme.</p></div></div></footer></div><!-- The Search results v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Tags Populares</h4><a class="post-tag" href="/tags/programacao/">programacao</a> <a class="post-tag" href="/tags/murilo-tech/">murilo tech</a> <a class="post-tag" href="/tags/murilo/">murilo</a> <a class="post-tag" href="/tags/historia/">historia</a> <a class="post-tag" href="/tags/github/">github</a> <a class="post-tag" href="/tags/software/">software</a> <a class="post-tag" href="/tags/relato/">relato</a> <a class="post-tag" href="/tags/mysql/">mysql</a> <a class="post-tag" href="/tags/maven/">maven</a> <a class="post-tag" href="/tags/jekyll/">jekyll</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <!-- The GA snippet v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-54279404-2', 'auto'); ga('send', 'pageview'); </script> <!-- Jekyll Simple Search loader v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://murilo.tech{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
